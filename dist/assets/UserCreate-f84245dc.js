import{c as E,r as p,j as e,L as T,i as q}from"./index-3d8791b8.js";import{P as I}from"./PageBreadcrumb-9dd34a07.js";import{F as m}from"./FormInput-5189d08c.js";import{u as L}from"./index.esm-f7d27dc8.js";import"./Table-e312cd55.js";import{o as Y,c as O,a as c}from"./index.esm-229abc95.js";import"./httpClient-96fbf256.js";import{S as x}from"./sweetalert2.esm.all-dd0c4ce7.js";import{C as b}from"./Card-a8049602.js";import{B as A}from"./Button-21cae2d8.js";import{F as z}from"./Form-70877923.js";import{R as f}from"./Row-10d1c5f5.js";import{C as d}from"./Col-c2024357.js";import"./createWithBsPrefix-36be1bdf.js";import"./InputGroupContext-c86885e2.js";import"./index-2400ada3.js";const H=Y(O().shape({username:c().required("Please enter Username"),email:c().email("Please enter a valid email").required("Please enter Email"),password:c().min(8,"Password must be at least 8 characters").required("Please enter Password"),phone_number:c().matches(/^03\d{2}\d{7}$/,"Please enter a valid mobile number e.g 03xx xxxxxxx").required("Please enter Phone Number"),role_name:c().required("Please select a Role")})),ne=()=>{var S,C;const N=L({resolver:H}),{permissions:j,isSuperUser:g}=E(),U=g||((S=j.Users)==null?void 0:S.Create),v=g||((C=j.Users)==null?void 0:C.View),{handleSubmit:k,register:a,control:t,reset:F,formState:{errors:n}}=N,[w,y]=p.useState(!1),[P,R]=p.useState([]),{user:_}=E(),B=async()=>{try{const r="https://backendapi.chase.boundlesstechnologies.net",s=_.token,o=await fetch(`${r}/api/users/role/`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(!o.ok){const i=(await o.json()).message||"Failed to fetch Role";throw new Error(i)}if(o.ok){const l=await o.json();console.log(" user data ",l.map(i=>i.role_name)),R(l)}}catch(r){x.fire({title:"Error!",text:r.message,icon:"error",timer:1500})}finally{}};p.useEffect(()=>{B()},[]);const $=async r=>{y(!0);try{const s=P.find(u=>u.role_name===r.role_name);console.log("selected user ",s),console.log("role id ",s==null?void 0:s._id);const o={username:r.username,email:r.email,password:r.password,phone_number:r.phone_number,userRoleId:s==null?void 0:s._id},l="https://backendapi.chase.boundlesstechnologies.net",i=_.token,h=await fetch(`${l}/api/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(o)});if(!h.ok){const u=await h.json();throw console.error("API error:",u),new Error(u.message||"User creation failed")}await h.json(),x.fire({title:"User Created Successfully!",icon:"success",timer:1500}),F()}catch(s){console.error("Error submitting User form:",s),x.fire({title:"Oops!",text:s.message,icon:"error",timer:1500})}finally{y(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Add New User",subName:"User"}),e.jsxs(b,{children:[e.jsx(b.Header,{children:e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-lg-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"header-title",children:"User Account"}),e.jsx("p",{className:"text-muted mb-0",children:"Fill in the information below to add a new user account"})]}),e.jsxs("div",{className:"mt-3 mt-lg-0",children:[" ",e.jsx(A,{style:{border:"none"},variant:"none",disabled:!v,children:e.jsx(T,{to:"/user/user-all",className:"btn btn-danger",children:"See All Users"})})]})]})}),e.jsx(z,{onSubmit:k($),children:e.jsxs(b.Body,{children:[e.jsxs(f,{children:[e.jsx(d,{lg:6,children:e.jsx(m,{label:"Name",type:"text",name:"username",placeholder:"Enter Your Name",containerClass:"mb-3",register:a,errors:n,control:t},"username")}),e.jsx(d,{lg:6,children:e.jsx(m,{label:"Email",type:"email",name:"email",placeholder:"Email",containerClass:"mb-3",register:a,errors:n,control:t},"email")})]}),e.jsxs(f,{children:[e.jsx(d,{lg:6,children:e.jsx(m,{label:"Phone Number",type:"number",name:"phone_number",placeholder:"Enter Your Phone Number",containerClass:"mb-3",register:a,errors:n,control:t},"phone_number")}),e.jsx(d,{lg:6,children:e.jsx(m,{label:"Password",type:"password",name:"password",placeholder:"Enter Your Password",containerClass:"mb-3",register:a,errors:n,control:t},"password")})]}),e.jsx(f,{children:e.jsx(d,{lg:6,children:e.jsxs(m,{name:"role_name",label:"Role",type:"select",containerClass:"mb-3",className:"form-select",register:a,errors:n,control:t,style:{maxHeight:"200px",overflowY:"auto"},children:[e.jsx("option",{value:"",children:"Select a Role"}),P.map(r=>e.jsx("option",{value:r.role_name,children:r.role_name},r._id))]},"role_name")})}),e.jsx(A,{type:"submit",variant:"success",disabled:w||!U,children:w?e.jsx(q,{}):"Register User"})]})})]})]})};export{ne as default};
