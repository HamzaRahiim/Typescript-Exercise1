import{r as h,R as P,c as V,j as e,S as G,L as O}from"./index-3d8791b8.js";import"./Table-e312cd55.js";import{F as I}from"./FormInput-5189d08c.js";import{u as _}from"./index.esm-f7d27dc8.js";import"./httpClient-96fbf256.js";import{S as A}from"./sweetalert2.esm.all-dd0c4ce7.js";import{R as T}from"./Row-10d1c5f5.js";import{C as z}from"./Col-c2024357.js";import{C as K}from"./Card-a8049602.js";import{T as k,N as y}from"./Tab-05d50737.js";import{B as $}from"./Button-21cae2d8.js";import{F as C}from"./Form-70877923.js";import"./index-2400ada3.js";import"./createWithBsPrefix-36be1bdf.js";import"./InputGroupContext-c86885e2.js";import"./NavContext-1798dc11.js";import"./useMergedRefs-ffb77068.js";import"./DataKey-e12315fd.js";import"./NavbarContext-4ad790bc.js";import"./NoopTransition-ab7d619d.js";import"./TransitionWrapper-ec82a515.js";const H=""+new URL("bg-profile-38acc387.jpg",import.meta.url).href;var R=globalThis&&globalThis.__assign||function(){return R=Object.assign||function(s){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(s[a]=r[a])}return s},R.apply(this,arguments)},J=globalThis&&globalThis.__rest||function(s,r){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&r.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(s);a<n.length;a++)r.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(s,n[a])&&(t[n[a]]=s[n[a]]);return t},M=function(s){var r=0;if(s.length===0)return!1;for(;r<s.length;){var t=s.charAt(r);if(t!=t.toLowerCase()){if(t==t.toUpperCase())return!0}r++}return!1},q=function(s){var r=0;if(s.length===0)return!1;for(;r<s.length;){var t=s.charAt(r);if(t!=t.toUpperCase()){if(t==t.toLowerCase())return!0}r++}return!1},Z=function(s){var r=s.className,t=s.style,n=s.rules,a=s.value,u=s.valueAgain,p=s.minLength,g=s.maxLength,v=s.rtl,w=s.onChange,f=s.specialCharsRegex,N=f===void 0?/[~`¿¡!#$%\^&*€£@+÷=\-\[\]\\';,/{}\(\)|\\":<>\?\.\_]/g:f,i=s.messages,c=i===void 0?{}:i,B=J(s,["className","style","rules","value","valueAgain","minLength","maxLength","rtl","onChange","specialCharsRegex","messages"]),j={minLength:{valid:a.length>=(p||100),message:c.minLength||"Password has at least ".concat(p," characters.")},specialChar:{valid:N.test(a),message:c.specialChar||"Password has special characters."},number:{valid:/\d/g.test(a),message:c.number||"Password has a number."},match:{valid:a.length>0&&a===u,message:c.match||"Passwords match."},capital:{valid:M(a),message:c.capital||"Password has a capital letter."},lowercase:{valid:q(a),message:c.lowercase||"Password has a lowercase letter."},capitalAndLowercase:{valid:M(a)&&q(a),message:c.capitalAndLowercase||"Password contains at least one uppercase and lowercase characters."},letter:{valid:/[a-zA-Z]/g.test(a),message:c.letter||"Password has a letter."},maxLength:{valid:a.length<=(g||16),message:c.maxLength||"Password has no more than ".concat(g," characters.")},notEmpty:{valid:!!(a.length>0&&u&&u.length>0),message:c.notEmpty||"Password fields are not empty."},noSpaces:{valid:a.length>0&&!/\s/.test(a),message:c.noSpaces||"Password contains no spaces."}},m=h.useMemo(function(){return n.filter(function(d){return!!j[d]})},[n]),b=m.every(function(d){return j[d].valid}),x=h.useMemo(function(){return m.filter(function(d){return!j[d].valid})},[a,u,m]);return h.useEffect(function(){typeof w=="function"&&w(b,x)},[b,x]),v&&(r=r?r+" rtl":"rtl"),P.createElement("ul",{className:r,style:R({margin:0,padding:0},t)},m.map(function(d){var S=j[d],L=S.message,F=S.valid;return P.createElement(Q,R({key:d,valid:F,iconSize:18,validColor:"#4BCA81",invalidColor:"#FF0033",rtl:v},B),L)}))},Q=function(s){var r=s.valid,t=s.iconSize,n=s.validColor,a=s.invalidColor,u=s.validTextColor,p=s.invalidTextColor,g=s.iconComponents,v=s.hideIcon,w=s.rtl,f=s.children,N=s.itemClassName;return P.createElement("li",{className:"".concat(N," ").concat(r?"valid":"invalid"),style:{listStyleType:"none",display:"flex",alignItems:"center",margin:"2px 0"}},v?null:g?r?g.ValidIcon:g.InvalidIcon:P.createElement("svg",{className:"checklist-icon",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 512 512",style:{marginRight:w?0:5,marginLeft:w?5:0}},P.createElement("path",{fill:r?n:a,d:r?"M432 64l-240 240-112-112-80 80 192 192 320-320z":"M507.331 411.33c-0.002-0.002-0.004-0.004-0.006-0.005l-155.322-155.325 155.322-155.325c0.002-0.002 0.004-0.003 0.006-0.005 1.672-1.673 2.881-3.627 3.656-5.708 2.123-5.688 0.912-12.341-3.662-16.915l-73.373-73.373c-4.574-4.573-11.225-5.783-16.914-3.66-2.080 0.775-4.035 1.984-5.709 3.655 0 0.002-0.002 0.003-0.004 0.005l-155.324 155.326-155.324-155.325c-0.002-0.002-0.003-0.003-0.005-0.005-1.673-1.671-3.627-2.88-5.707-3.655-5.69-2.124-12.341-0.913-16.915 3.66l-73.374 73.374c-4.574 4.574-5.784 11.226-3.661 16.914 0.776 2.080 1.985 4.036 3.656 5.708 0.002 0.001 0.003 0.003 0.005 0.005l155.325 155.324-155.325 155.326c-0.001 0.002-0.003 0.003-0.004 0.005-1.671 1.673-2.88 3.627-3.657 5.707-2.124 5.688-0.913 12.341 3.661 16.915l73.374 73.373c4.575 4.574 11.226 5.784 16.915 3.661 2.080-0.776 4.035-1.985 5.708-3.656 0.001-0.002 0.003-0.003 0.005-0.005l155.324-155.325 155.324 155.325c0.002 0.001 0.004 0.003 0.006 0.004 1.674 1.672 3.627 2.881 5.707 3.657 5.689 2.123 12.342 0.913 16.914-3.661l73.373-73.374c4.574-4.574 5.785-11.227 3.662-16.915-0.776-2.080-1.985-4.034-3.657-5.707z"})),P.createElement("span",{style:{paddingTop:2,opacity:r?1:p?void 0:.5,flex:1,color:r?u:p}},f))};const ve=()=>{const s="https://backendapi.chase.boundlesstechnologies.net",{user:r,updateUserName:t}=V(),{token:n}=r,a=_(),{handleSubmit:u,register:p,watch:g,formState:{errors:v}}=a,w=g("newPassword"),[f,N]=h.useState(!1),[i,c]=h.useState(null),[B,j]=h.useState(!1),[m,b]=h.useState(!1),[x,d]=h.useState({username:"",email:"",phone_number:""}),S=async()=>{try{j(!0);const l=await fetch(`${s}/api/users/me`,{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!l.ok)throw new Error("Failed to fetch user info");const o=await l.json();o&&(c({username:o.username||"N/A",email:o.email||"N/A",phone_number:o.phone_number||"N/A",role:o.role.role_name||"N/A"}),d({username:o.username||"",email:o.email||"",phone_number:o.phone_number||""}))}catch(l){console.error("Error fetching user info:",l)}finally{j(!1)}};h.useEffect(()=>{S()},[n]);const L=l=>{const{name:o,value:E}=l.target;d(U=>({...U,[o]:E}))},F=async l=>{l.preventDefault(),b(!0);try{const o=await fetch(`${s}/api/users/update-info`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(x)});if(!o.ok)throw new Error("Failed to update user info");const E=await o.json();E&&A.fire({title:"Success!",text:"Info updated successfully",icon:"success",confirmButtonText:"OK",timer:1500}),S(),t(x.username),console.log("User Info updated:",E)}catch(o){console.error("Error updating user info:",o),A.fire({title:"Error!",text:"Failed to update info",icon:"error",timer:1500})}finally{b(!1)}},D=async l=>{if(!f){A.fire({title:"Error!",text:"New password does not meet validation criteria.",icon:"error",timer:1500});return}b(!0);try{const o=await fetch(`${s}/api/users/me/password`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:l.currentPassword,newPassword:l.newPassword})});if(!o.ok){const U=await o.json();throw new Error(U.message||"Failed to update password")}await o.json()&&A.fire({title:"Success!",text:"Password updated successfully",icon:"success",confirmButtonText:"OK",timer:1500})}catch(o){console.error("Error updating user Password:",o),A.fire({title:"Error!",text:o.message,icon:"error",timer:1500})}finally{b(!1)}};return B?e.jsx(G,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(T,{children:e.jsxs(z,{sm:12,children:[e.jsx("div",{className:"profile-bg-picture",style:{backgroundImage:`url(${H})`},children:e.jsx("span",{className:"picture-bg-overlay"})}),e.jsx("div",{className:"profile-user-box",children:e.jsx(T,{children:e.jsx(z,{sm:6,children:e.jsxs("div",{children:[e.jsx("h4",{className:"mt-4 fs-17 ellipsis",children:(i==null?void 0:i.username)||"User Name"}),e.jsx("p",{className:"font-13",children:(i==null?void 0:i.role)||"Role"}),e.jsx("p",{className:"text-muted mb-0",children:e.jsx("small",{children:"Pakistan"})})]})})})})]})}),e.jsx(T,{children:e.jsx(z,{sm:12,children:e.jsx(K,{className:"p-0",children:e.jsx(K.Body,{className:"p-0",children:e.jsx("div",{className:"profile-content",children:e.jsxs(k.Container,{defaultActiveKey:"About",children:[e.jsxs(y,{as:"ul",justify:!0,className:"nav-underline gap-0",children:[e.jsx(y.Item,{as:"li",children:e.jsx(y.Link,{as:O,to:"#",eventKey:"About",type:"button",children:"About"})}),e.jsx(y.Item,{children:e.jsx(y.Link,{as:O,to:"#",eventKey:"Settings",type:"button",children:"Settings"})}),e.jsx(y.Item,{children:e.jsx(y.Link,{as:O,to:"#",eventKey:"ChangePassword",type:"button",children:"Change Password"})})]}),e.jsxs(k.Content,{className:"m-0 p-4",children:[e.jsx(k.Pane,{eventKey:"About",children:e.jsxs("div",{className:"profile-desk",children:[e.jsx("h5",{className:"text-uppercase fs-17 text-dark",children:(i==null?void 0:i.username)||"User Name"}),e.jsx("div",{className:"designation mb-4",children:(i==null?void 0:i.role)||"Role Name"}),e.jsx("h5",{className:"mt-4 fs-17 text-dark",children:"Contact Information"}),e.jsx("table",{className:"table table-condensed mb-0 border-top",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:"Email"}),e.jsx("td",{children:e.jsx(O,{to:"",className:"ng-binding",children:(i==null?void 0:i.email)||"user email"})})]}),e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:"Phone"}),e.jsx("td",{className:"ng-binding",children:(i==null?void 0:i.phone_number)||"user phone number"})]})]})})]})}),e.jsx(k.Pane,{eventKey:"Settings",children:e.jsxs("form",{onSubmit:F,children:[e.jsxs(T,{children:[e.jsx(I,{name:"username",label:"Full Name",type:"text",containerClass:"mb-2",value:x.username,onChange:L}),e.jsx(I,{name:"email",label:"Email",type:"email",containerClass:"mb-3",value:x.email,onChange:L}),e.jsx(I,{name:"phone_number",label:"Phone Number",type:"number",containerClass:"mb-3",value:x.phone_number,onChange:L})]}),e.jsx($,{variant:"success",type:"submit",disabled:m,children:m?"Updating...":"Save Changes"})]})}),e.jsx(k.Pane,{eventKey:"ChangePassword",children:e.jsxs(C,{onSubmit:u(D),children:[e.jsxs(T,{children:[e.jsxs(C.Group,{className:"mb-3",children:[e.jsx(C.Label,{children:"Current Password"}),e.jsx(C.Control,{type:"password",placeholder:"Enter current password",...p("currentPassword",{required:"Current password is required"}),isInvalid:!!v.currentPassword})]}),e.jsxs(C.Group,{className:"mb-3",children:[e.jsx(C.Label,{children:"New Password"}),e.jsx(C.Control,{type:"password",placeholder:"Enter new password",...p("newPassword",{required:"New password is required",validate:l=>{if(!f)return"Password is invalid"}}),isInvalid:!!v.newPassword})]})]}),e.jsx(Z,{rules:["minLength","specialChar","number","capital"],minLength:8,value:w||"",onChange:l=>N(l),iconSize:10}),e.jsx($,{type:"submit",className:"mt-3",disabled:m||!f,variant:"success",children:m?"Updating...":"Change Password"})]})})]})]})})})})})})]})})};export{ve as default};
