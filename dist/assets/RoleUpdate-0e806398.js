import{k as E,c as B,r as n,j as e,l as o,L as _,i as F}from"./index-3d8791b8.js";import"./httpClient-96fbf256.js";import{P as I}from"./PageBreadcrumb-9dd34a07.js";import{F as L}from"./FormInput-5189d08c.js";import"./Table-e312cd55.js";import{S as U}from"./sweetalert2.esm.all-dd0c4ce7.js";import{C as m}from"./Card-a8049602.js";import{B as S}from"./Button-21cae2d8.js";import{R as T}from"./Row-10d1c5f5.js";import{C as $}from"./Col-c2024357.js";import{T as O}from"./Table-1d1464cf.js";import{F as d}from"./Form-70877923.js";import"./createWithBsPrefix-36be1bdf.js";import"./InputGroupContext-c86885e2.js";import"./index-2400ada3.js";const ae=()=>{var C,k;const{id:i}=E(),{user:f,isSuperUser:p,permissions:x}=B(),{token:R}=f,v="https://backendapi.chase.boundlesstechnologies.net",[j,u]=n.useState(""),[g,P]=n.useState(!0),[y,b]=n.useState(!1),D=p||((C=x.Users)==null?void 0:C.Update),N=p||((k=x.Users)==null?void 0:k.View),V={Products:{Create:!1,View:!1,Update:!1,Delete:!1},Orders:{Create:!1,View:!1,Update:!1,Delete:!1},Shippings:{Create:!1,View:!1,Update:!1,Delete:!1},Users:{Create:!1,View:!1,Update:!1,Delete:!1},Inventory:{Create:!1,View:!1,Update:!1,Delete:!1},Policies:{Create:!1,View:!1,Update:!1,Delete:!1},Settings:{Create:!1,View:!1,Update:!1,Delete:!1},Customers:{Create:!1,View:!1,Update:!1,Delete:!1}},[l,w]=n.useState(V),c=(s,t)=>{w(r=>({...r,[s]:{...r[s],[t]:!r[s][t]}}))};if(n.useEffect(()=>{(async()=>{try{const t=await fetch(`${v}/api/users/role`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R}`}}),r=await t.json();if(t.ok){const a=r.find(h=>h._id===i);a?(console.log("User Role:",a),u(a.role_name),w(a.permissions)):console.log("No role found for the provided user ID.")}else console.error("Failed to fetch roles:",r.message)}catch(t){console.error("Error fetching roles:",t)}finally{P(!1)}})()},[i]),g)return e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:[e.jsx(o,{animation:"grow",style:{margin:"0 5px"}}),e.jsx(o,{animation:"grow",style:{margin:"0 5px"}}),e.jsx(o,{animation:"grow",style:{margin:"0 5px"}})]});const A=async()=>{b(!0);const s={role_name:j,permissions:l};console.log(s);try{const t=f.token,a=await fetch(`https://backendapi.chase.boundlesstechnologies.net/api/users/role/${i||""}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)});if(!a.ok){const h=await a.json();throw new Error(h.message||"Role Updation failed")}a.ok&&(await a.json(),U.fire({title:"Update Successfully!",text:"Role with permission has been updated successfully!",icon:"success",timer:1500}))}catch(t){console.log(" error is caught ",t),U.fire({title:"Sorry!",text:"An Error Occured, while updating Role Policy. Please try again later.",icon:"error",timer:1500})}finally{b(!1)}if(g)return e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:[e.jsx(o,{animation:"grow",style:{margin:"0 5px"}}),e.jsx(o,{animation:"grow",style:{margin:"0 5px"}}),e.jsx(o,{animation:"grow",style:{margin:"0 5px"}})]})};return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Update Role",subName:"User"}),e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-lg-center",children:[e.jsx("div",{children:e.jsx("h4",{className:"header-title",children:"Role & Permission"})}),e.jsxs("div",{className:"mt-3 mt-lg-0",children:[" ",e.jsx(S,{style:{border:"none"},variant:"none",disabled:!N,children:e.jsx(_,{to:"/user/role-all",className:"btn btn-danger",children:"See All Roles"})})]})]})}),e.jsxs(m.Body,{children:[e.jsx(T,{children:e.jsx($,{lg:6,children:e.jsx(L,{label:"Role",type:"text",name:"role_name",value:j,placeholder:"Enter Role Name",onChange:s=>u(s.target.value),containerClass:"mb-3"},"role_name")})}),e.jsx("div",{className:"table-responsive-sm",children:e.jsxs(O,{className:"table-hover table-centered mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Page"}),e.jsx("th",{children:"View"}),e.jsx("th",{children:"Create"}),e.jsx("th",{children:"Update"}),e.jsx("th",{children:"Delete"})]})}),e.jsx("tbody",{children:Object.keys(l).map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s}),e.jsx("td",{children:e.jsx(d.Check,{type:"checkbox",style:{margin:"0 auto",display:"block"},checked:l[s].View,onChange:()=>c(s,"View")})}),e.jsx("td",{children:e.jsx(d.Check,{type:"checkbox",style:{margin:"0 auto",display:"block"},checked:l[s].Create,onChange:()=>c(s,"Create")})}),e.jsx("td",{children:e.jsx(d.Check,{type:"checkbox",style:{margin:"0 auto",display:"block"},checked:l[s].Update,onChange:()=>c(s,"Update")})}),e.jsx("td",{children:e.jsx(d.Check,{type:"checkbox",style:{margin:"0 auto",display:"block"},checked:l[s].Delete,onChange:()=>c(s,"Delete")})})]},s))})]})}),e.jsx(S,{className:"mt-3",variant:"success",onClick:A,disabled:y||!D,children:y?e.jsx(F,{}):"Save Role & Permission"})]})]})]})};export{ae as default};
