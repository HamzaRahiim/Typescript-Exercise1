import{c as je,r,u as ye,j as e,S as Ce}from"./index-3d8791b8.js";import{P as be}from"./PageBreadcrumb-9dd34a07.js";import{F as W}from"./FormInput-5189d08c.js";import{u as we}from"./index.esm-f7d27dc8.js";import"./Table-e312cd55.js";import{c as Se,d as Ne}from"./index-e5c69e61.js";import"./httpClient-96fbf256.js";import{S as n}from"./sweetalert2.esm.all-dd0c4ce7.js";import{S as ve}from"./SingleFileUploader-c9e26641.js";import{C as F}from"./Card-a8049602.js";import{B as p}from"./Button-21cae2d8.js";import{F as l}from"./Form-70877923.js";import{T as Ee}from"./Table-1d1464cf.js";import{B as b}from"./Pagination-ded171f0.js";import{M as w}from"./Modal-9ed1e250.js";import"./Row-10d1c5f5.js";import"./Col-c2024357.js";import"./createWithBsPrefix-36be1bdf.js";import"./InputGroupContext-c86885e2.js";import"./index-2400ada3.js";import"./iconBase-ce8e5803.js";import"./useMergedRefs-ffb77068.js";import"./useCallbackRef-8cbe87ce.js";import"./AbstractModalHeader-14d7211d.js";import"./useWindow-a78371ce.js";import"./NoopTransition-ab7d619d.js";import"./TransitionWrapper-ec82a515.js";import"./DataKey-e12315fd.js";const tt=()=>{var J,K,V;const{isSuperUser:S,permissions:N,user:Y}=je(),U=S||((J=N.Products)==null?void 0:J.Update),q=S||((K=N.Products)==null?void 0:K.Delete),$=S||((V=N.Products)==null?void 0:V.Create),[i,v]=r.useState([]),[T,Q]=r.useState(""),[c,I]=r.useState(1),[h,X]=r.useState(15),[E,Z]=r.useState(!0),[ee,te]=r.useState(!1),[f,A]=r.useState(null),[se,j]=r.useState(!1),[ae,M]=r.useState(!1),[B,oe]=r.useState([]),[o,y]=r.useState(null),d="https://backendapi.chase.boundlesstechnologies.net",{token:g}=Y,{handleSubmit:re,register:L,reset:m,control:_,setValue:u,formState:{errors:z}}=we();r.useEffect(()=>{I(1),te(i.length>0)},[h,i]),r.useEffect(()=>{x()},[]);const ne=async t=>{try{if(!(await fetch(`${d}/api/categories/category/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`}})).ok)throw new Error("Failed to delete category");x(),n.fire({title:"Deleted!",text:"Category deleted successfully.",icon:"success",timer:1500})}catch{n.fire("Oops!","Category deletion failed.","error")}},ie=async()=>{try{if(console.log(" selected Rows ",i),!(await fetch(`${d}/api/categories/categories`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({ids:i})})).ok)throw new Error("Failed to delete category");x(),n.fire({title:"Deleted!",text:`All the selected ${i.length} Category deleted successfully.`,icon:"success",timer:1500})}catch{n.fire("Oops!","Category deletion failed.","error")}},le=()=>{n.fire({title:"Are you sure?",text:`All the ${i.length} selected items will be deleted!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Remove All!"}).then(t=>{t.isConfirmed&&(ie(),console.log("delete user success"))}),console.log("Delete IDs:",i)},ce=t=>{t.target.checked?v(B.map(s=>s._id)):v([])},de=t=>{v(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},me=t=>{n.fire({title:"Are you sure?",text:"This Items will be deleted!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Remove!"}).then(s=>{s.isConfirmed&&(ne(t),console.log("delete user success"))})},pe=t=>{Q(t.target.value)},he=()=>{Z(!E)},R=B.filter(t=>t.name.toLowerCase().includes(T.toLowerCase())).sort((t,s)=>E?t.name.localeCompare(s.name):s.name.localeCompare(t.name)),k=t=>{I(t)},O=Math.ceil(R.length/h),G=R.slice((c-1)*h,c*h),[C,D]=ye(),H=()=>{C&&(m({name:"",description:""}),A(null),y(null)),D()},ge=async t=>{console.log("Category Data:",t);const s=new FormData;s.append("name",t.name),s.append("description",t.description),f&&s.append("image",f),j(!0);try{const a=await fetch(`${d}/api/categories/category`,{method:"POST",headers:{Authorization:`Bearer ${g}`},body:s});if(!a.ok){const P=await a.json();throw new Error(P.message||"Failed to Add Category")}await a.json()&&(n.fire({title:"ADDED!",text:"Category added successfully!",icon:"success",confirmButtonText:"OK",timer:1500}),x(),m())}catch(a){console.error("Error Adding Category",a),n.fire({title:"Oops!",text:a.message,icon:"error",timer:1500})}finally{j(!1)}},x=async()=>{try{M(!0);const t=await fetch(`${d}/api/categories/category`,{method:"GET",headers:{Authorization:`Bearer ${g}`}});if(!t.ok){const a=await t.json();throw new Error(a.message||"Failed to get categories")}const s=await t.json();s&&oe(s),console.log(" date get from the api is ",s)}catch(t){console.error("Error updating user Password:",t)}finally{M(!1)}},ue=async t=>{console.log("Updating Category Data:",t);const s=new FormData;s.append("name",t.name),s.append("description",t.description),f&&s.append("image",f),j(!0);try{const a=await fetch(`${d}/api/categories/category/${o==null?void 0:o._id}`,{method:"PUT",headers:{Authorization:`Bearer ${g}`},body:s});if(!a.ok){const P=await a.json();throw new Error(P.message||"Failed to Update Category")}await a.json()&&(n.fire({title:"Updated!",text:"Category updated successfully!",icon:"success",confirmButtonText:"OK",timer:1500}),x(),m(),y(null))}catch(a){console.error("Error Updating Category",a),n.fire({title:"Oops!",text:a.message,icon:"error",timer:1500})}finally{j(!1)}},xe=t=>{y(t),u("name",t.name),u("description",t.description||""),D()};return r.useEffect(()=>{C||(m(),A(null),y(null))},[C,m]),r.useEffect(()=>{o?(u("name",o.name),u("description",o.description||"")):m({name:"",description:""})},[o,u,m]),ae?e.jsx(Ce,{}):e.jsxs(e.Fragment,{children:[e.jsx(be,{title:"Categories",subName:"Products"}),e.jsxs(F,{children:[e.jsxs(F.Header,{children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-lg-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"header-title",children:"Category Management"}),e.jsx("p",{className:"text-muted mb-0",children:"Add and Manage your all Product categories here."})]}),e.jsxs("div",{className:"mt-3 mt-lg-0",children:[" ",e.jsxs(p,{style:{border:"none"},disabled:!$,variant:"success",onClick:D,children:[e.jsx("i",{className:"bi bi-plus"})," Add New Category"]}),ee&&e.jsx(p,{variant:"danger",className:"ms-2",onClick:le,children:"Delete All Selected"})]})]}),e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mt-3",children:[e.jsx("div",{className:"app-search d-none d-lg-block",children:e.jsx("form",{children:e.jsxs("div",{className:"input-group",style:{backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:"10px",border:"1px solid rgba(0, 0, 0, 0.1)"},children:[e.jsx("input",{type:"search",className:"form-control",placeholder:"Search Category here...",value:T,onChange:pe,style:{backgroundColor:"transparent",border:"none",paddingLeft:"10px",color:"#333"}}),e.jsx("span",{className:"ri-search-line search-icon text-muted",style:{marginRight:"10px",color:"#666"}})]})})}),e.jsxs(l.Select,{value:h,style:{zIndex:1},onChange:t=>X(Number(t.target.value)),className:"w-auto mt-3 mt-lg-0",children:[e.jsx("option",{value:15,children:"15 items"}),e.jsx("option",{value:30,children:"30 items"}),e.jsx("option",{value:40,children:"40 items"})]})]})]}),e.jsx(F.Body,{children:e.jsxs("div",{className:"table-responsive-sm",children:[e.jsxs(Ee,{className:"table-striped table-centered mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{children:[e.jsx("input",{type:"checkbox",onChange:ce,checked:i.length===B.length})," "]}),e.jsx("th",{children:"Image"}),e.jsx("th",{children:e.jsxs("span",{onClick:he,style:{cursor:"pointer"},children:["Name ",E?"↑":"↓"]})}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:G.length>0?(G||[]).map((t,s)=>{const a=i.includes(t._id);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:a,onChange:()=>de(t._id)})}),e.jsx("td",{className:"table-user",children:t!=null&&t.image?e.jsx("img",{src:`${d}/uploads/images/${t.image}`,alt:"category",className:"me-2 rounded-circle"}):""}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.description}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(p,{variant:"secondary",disabled:!U,onClick:()=>xe(t),children:e.jsx(Se,{})}),e.jsx(p,{variant:"danger",className:"ms-2",onClick:()=>me(t._id.toString()),disabled:!q,children:e.jsx(Ne,{})})]})})]},s)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No records found"})})})]}),e.jsx("nav",{className:"d-flex justify-content-end mt-3",children:e.jsxs(b,{className:"pagination-rounded mb-0",children:[e.jsx(b.Prev,{onClick:()=>c>1&&k(c-1)}),Array.from({length:O},(t,s)=>e.jsx(b.Item,{active:s+1===c,onClick:()=>k(s+1),children:s+1},s+1)),e.jsx(b.Next,{onClick:()=>c<O&&k(c+1)})]})})]})}),e.jsxs(w,{show:C,onHide:H,dialogClassName:"modal-dialog-centered",children:[e.jsx(w.Header,{closeButton:!0,children:e.jsx("h4",{className:"modal-title",children:o?"Update Category":"Add New Category"})}),e.jsxs(l,{onSubmit:re(o?ue:ge),children:[e.jsxs(w.Body,{children:[e.jsx(l.Group,{className:"mb-3",children:e.jsx(W,{label:"Name",type:"text",name:"name",containerClass:"mb-3",register:L,placeholder:"Enter Category Name here..",errors:z,control:_})}),e.jsxs(l.Group,{className:"mb-2",children:[e.jsx(l.Label,{children:"Description"}),e.jsx("p",{style:{fontSize:"0.8rem"},className:"mb-2",children:"You may write a description of up to 15 words."}),e.jsx(W,{type:"textarea",name:"description",containerClass:"mb-3",register:L,placeholder:"Enter Description here..",errors:z,control:_})]}),e.jsxs(l.Group,{className:"mb-2",children:[e.jsx(l.Label,{children:o?"Upload New Image":"Upload Image"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{style:{fontSize:"0.8rem"},className:"text-danger mb-0",children:"File Size: Upload images up to 5 MB."}),e.jsx("p",{style:{fontSize:"0.8rem"},className:"text-danger mb-0",children:"Supported Formats: JPEG (.jpg, .jpeg), PNG (.png), GIF(.gif), WebP (.webp), and SVG (.svg)."}),e.jsx("p",{style:{fontSize:"0.8rem"},className:"text-danger mb-0",children:"Upload Limit: Only 1 image can be uploaded."})]}),e.jsx(ve,{icon:"ri-upload-cloud-2-line",text:"Drop file here or click to upload a product image.",onFileUpload:t=>A(t)}),(o==null?void 0:o.image)&&e.jsxs("div",{className:"mt-3 d-flex flex-column ",children:[e.jsx(l.Label,{children:"Current Image"}),e.jsx("img",{src:`${d}/uploads/images/${o.image}`,alt:"Category",className:"img-thumbnail mb-3",style:{width:"100px",height:"100px"}})]})]})]}),e.jsxs(w.Footer,{children:[e.jsx(p,{variant:"light",onClick:H,children:"Close"}),e.jsx(p,{variant:"soft-success",type:"submit",disabled:o?!U:!$,children:se?o?"Updating...":"Adding...":o?"Update Category":"Save Category"})]})]})]})]})]})};export{tt as default};
