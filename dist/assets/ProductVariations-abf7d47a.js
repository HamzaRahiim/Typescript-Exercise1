import{c as je,r as n,u as ve,j as e,S as ye}from"./index-3d8791b8.js";import{P as Ae}from"./PageBreadcrumb-9dd34a07.js";import{F as we}from"./FormInput-5189d08c.js";import{u as be}from"./index.esm-f7d27dc8.js";import"./Table-e312cd55.js";import{c as Se,d as Ce}from"./index-e5c69e61.js";import"./httpClient-96fbf256.js";import{S as o}from"./sweetalert2.esm.all-dd0c4ce7.js";import{C as $}from"./Card-a8049602.js";import{B as m}from"./Button-21cae2d8.js";import{F as g}from"./Form-70877923.js";import{T as Ne}from"./Table-1d1464cf.js";import{B as y}from"./Pagination-ded171f0.js";import{M as f}from"./Modal-9ed1e250.js";import"./Row-10d1c5f5.js";import"./Col-c2024357.js";import"./createWithBsPrefix-36be1bdf.js";import"./InputGroupContext-c86885e2.js";import"./index-2400ada3.js";import"./iconBase-ce8e5803.js";import"./useMergedRefs-ffb77068.js";import"./useCallbackRef-8cbe87ce.js";import"./AbstractModalHeader-14d7211d.js";import"./useWindow-a78371ce.js";import"./NoopTransition-ab7d619d.js";import"./TransitionWrapper-ec82a515.js";import"./DataKey-e12315fd.js";const Be=()=>{var E,W,q;const{isSuperUser:w,permissions:b,user:X}=je(),M=w||((E=b.Products)==null?void 0:E.Update),Z=w||((W=b.Products)==null?void 0:W.Delete),O=w||((q=b.Products)==null?void 0:q.Create),[l,S]=n.useState([]),[F,ee]=n.useState(""),[i,R]=n.useState(1),[u,te]=n.useState(15),[C,ae]=n.useState(!0),[se,re]=n.useState(!1),[ne,x]=n.useState(!1),[oe,U]=n.useState(!1),[ie,V]=n.useState(!1),[L,le]=n.useState([]),[p,z]=n.useState(null),c="https://backendapi.chase.boundlesstechnologies.net",{token:j}=X,{handleSubmit:N,register:k,control:ce,reset:G,setValue:de,formState:{errors:Y}}=be(),[H,T]=ve();n.useEffect(()=>{R(1),re(l.length>0)},[u,l]),n.useEffect(()=>{D()},[]);const J=L.filter(a=>a.name.toLowerCase().includes(F.toLowerCase())).sort((a,s)=>C?a.name.localeCompare(s.name):s.name.localeCompare(a.name)),_=a=>{R(a)},I=Math.ceil(J.length/u),A=J.slice((i-1)*u,i*u),B=()=>{H&&(G({name:""}),z(null)),T()},K=a=>{z(a),de("name",a.name),T()},P=a=>{U(a.target.checked),a.target.checked?S(L.map(s=>s._id)):S([])},he=a=>{S(s=>{const d=s.includes(a)?s.filter(t=>t!==a):[...s,a];return U(d.length===A.length),d})},me=a=>{ee(a.target.value)},ue=()=>{ae(!C)},pe=a=>{o.fire({title:"Are you sure?",text:"This variant will be deleted!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Remove!"}).then(s=>{s.isConfirmed&&Q(a)})},xe=()=>{o.fire({title:"Are you sure?",text:`All the ${l.length} selected variants will be deleted!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete them!"}).then(a=>{a.isConfirmed&&(Q(l),console.log("Delete variants:",l))})},ge=async a=>{try{x(!0);const s=await fetch(`${c}/api/variants/variant-names`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({name:a.name})});if(!s.ok){const t=await s.json();throw new Error(t.message||"Failed to add new variant")}await s.json()&&(B(),o.fire({title:"Added!",text:"Variant added successfully!",icon:"success",confirmButtonText:"OK",timer:1500}),D())}catch(s){console.error("Error adding variant:",s),o.fire({title:"Oops!",text:s.message,icon:"error",timer:1500})}finally{x(!1)}},D=async()=>{try{V(!0);const a=await fetch(`${c}/api/variants/variant-names`,{method:"GET",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"}});if(!a.ok){const d=await a.json();throw new Error(d.message||"Failed to get variants")}const s=await a.json();le(s)}catch(a){console.error("Error getting variants data:",a)}finally{V(!1)}},fe=async a=>{try{x(!0);const s=await fetch(`${c}/api/variants/variant-names/${p==null?void 0:p._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({name:a.name})});if(!s.ok){const t=await s.json();throw new Error(t.message||"Failed to update variant")}await s.json()&&(B(),await D(),o.fire({title:"Updated!",text:"Variant updated successfully!",icon:"success",confirmButtonText:"OK",timer:1500}),G(),z(null))}catch(s){console.error("Error updating variant:",s),o.fire({title:"Oops!",text:s.message,icon:"error",timer:1500})}finally{x(!1)}},Q=async a=>{try{const s=typeof a=="string"?[a]:a;if(!(await fetch(`${c}/api/variants/variant-names/bulk-delete`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({ids:s})})).ok)throw new Error("Failed to delete variant");o.fire({title:"Deleted!",text:"Variant deleted successfully.",icon:"success",timer:1500}),D()}catch(s){console.error("Error deleting variant:",s),o.fire({title:"Oops!",text:s.message,icon:"error",timer:1500})}finally{V(!1)}};return ie?e.jsx(ye,{}):e.jsx(e.Fragment,{children:e.jsxs($,{children:[e.jsxs($.Header,{children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-lg-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"header-title",children:"Variant Management"}),e.jsx("p",{className:"text-muted mb-0",children:"Add and manage your variants name here."})]}),e.jsxs("div",{className:"mt-3 mt-lg-0",children:[e.jsxs(m,{style:{border:"none"},variant:"success",disabled:!O,onClick:T,children:[e.jsx("i",{className:"bi bi-plus"})," Add New Variant"]}),se&&e.jsx(m,{variant:"danger",className:"ms-2",onClick:xe,children:"Delete Selected"})]})]}),e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mt-3",children:[e.jsx("div",{className:"app-search d-none d-lg-block",children:e.jsx("form",{children:e.jsxs("div",{className:"input-group",style:{backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:"10px",border:"1px solid rgba(0, 0, 0, 0.1)"},children:[e.jsx("input",{type:"search",className:"form-control",placeholder:"Search Variant here...",value:F,onChange:me,style:{backgroundColor:"transparent",border:"none",paddingLeft:"10px",color:"#333"}}),e.jsx("span",{className:"ri-search-line search-icon text-muted",style:{marginRight:"10px",color:"#666"}})]})})}),e.jsxs(g.Select,{value:u,onChange:a=>te(Number(a.target.value)),className:"w-auto mt-3 mt-lg-0",children:[e.jsx("option",{value:15,children:"15 items"}),e.jsx("option",{value:30,children:"30 items"}),e.jsx("option",{value:40,children:"40 items"})]})]})]}),e.jsx($.Body,{children:e.jsxs("div",{className:"table-responsive-sm",children:[e.jsxs(Ne,{className:"table-striped table-centered mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("input",{type:"checkbox",onChange:P,checked:oe})}),e.jsx("th",{children:e.jsxs("span",{onClick:ue,style:{cursor:"pointer"},children:["Variant Name ",C?"↑":"↓"]})}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:A.length>0?A.map((a,s)=>{const d=l.includes(a._id);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:d,onChange:()=>he(a._id)})}),e.jsx("td",{children:a.name}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(m,{variant:"secondary",disabled:!M,onClick:()=>K(a),children:e.jsx(Se,{})}),e.jsx(m,{variant:"danger",className:"ms-2",onClick:()=>pe(a._id.toString()),disabled:!Z,children:e.jsx(Ce,{})})]})})]},s)}):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center",children:"No variants found"})})})]}),e.jsx("nav",{className:"d-flex justify-content-end mt-3",children:e.jsxs(y,{className:"pagination-rounded mb-0",children:[e.jsx(y.Prev,{onClick:()=>i>1&&_(i-1)}),Array.from({length:I},(a,s)=>e.jsx(y.Item,{active:s+1===i,onClick:()=>_(s+1),children:s+1},s+1)),e.jsx(y.Next,{onClick:()=>i<I&&_(i+1)})]})})]})}),e.jsxs(f,{show:H,onHide:B,dialogClassName:"modal-dialog-centered",children:[e.jsx(f.Header,{closeButton:!0,children:e.jsx("h4",{className:"modal-title",children:p?"Update Variant":"Add New Variant"})}),e.jsxs(g,{onSubmit:N(p?fe:ge),children:[e.jsx(f.Body,{children:e.jsx(g.Group,{className:"mb-3",children:e.jsx(we,{label:"Variant Name",type:"text",name:"name",containerClass:"mb-3",register:k,placeholder:"Enter variant name here...",errors:Y,control:ce})})}),e.jsxs(f.Footer,{children:[e.jsx(m,{variant:"light",onClick:B,children:"Close"}),e.jsx(m,{variant:"soft-success",type:"submit",disabled:p?!M:!O,children:ne?p?"Updating...":"Adding...":p?"Update Variant":"Save Variant"})]})]})]})]})})},at=()=>{var a,s,d;const{isSuperUser:w,permissions:b,user:X}=je(),M=w||((a=b.Products)==null?void 0:a.Update),Z=w||((s=b.Products)==null?void 0:s.Delete),O=w||((d=b.Products)==null?void 0:d.Create),[l,S]=n.useState([]),[F,ee]=n.useState(""),[i,R]=n.useState(1),[u,te]=n.useState(15),[C,ae]=n.useState(!0),[se,re]=n.useState(!1),[ne,x]=n.useState(!1),[oe,U]=n.useState(!1),[ie,V]=n.useState(!1),[L,le]=n.useState([]),[p,z]=n.useState([]),[c,j]=n.useState(null),N="https://backendapi.chase.boundlesstechnologies.net",{token:k}=X,{handleSubmit:ce,register:G,control:de,reset:Y,setValue:H,formState:{errors:T}}=be(),[J,_]=ve();n.useEffect(()=>{R(1),re(l.length>0)},[u,l]),n.useEffect(()=>{E()},[]),n.useEffect(()=>{fe()},[]);const I=L.filter(t=>t.value.toLowerCase().includes(F.toLowerCase())).sort((t,r)=>C?t.value.localeCompare(r.value):r.value.localeCompare(t.value)),A=t=>{R(t)},B=Math.ceil(I.length/u),K=I.slice((i-1)*u,i*u),P=()=>{J&&(Y({variantName:"",value:""}),j(null)),_()},he=t=>{j(t),H("variantName",t.variantName._id),H("value",t.value),_()},me=t=>{U(t.target.checked),t.target.checked?S(L.map(r=>r._id)):S([])},ue=t=>{S(r=>{const h=r.includes(t)?r.filter(v=>v!==t):[...r,t];return U(h.length===K.length),h})},pe=t=>{ee(t.target.value)},xe=()=>{ae(!C)},ge=t=>{o.fire({title:"Are you sure?",text:"This product variant will be deleted!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Remove!"}).then(r=>{r.isConfirmed&&q(t)})},D=()=>{o.fire({title:"Are you sure?",text:`All the ${l.length} selected product variants will be deleted!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete them!"}).then(t=>{t.isConfirmed&&(q(l),console.log("Delete product variants:",l))})},fe=async()=>{try{const t=await fetch(`${N}/api/variants/variant-names`,{method:"GET",headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch variant names");const r=await t.json();z(r)}catch(t){console.error("Error fetching variant names:",t)}},Q=async t=>{try{x(!0);const r=await fetch(`${N}/api/variants/product-variants`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({variantName:t.variantName,value:t.value})});if(!r.ok){const v=await r.json();throw new Error(v.message||"Failed to add new product variant")}await r.json()&&(P(),o.fire({title:"Added!",text:"Product variant added successfully!",icon:"success",confirmButtonText:"OK",timer:1500}),E())}catch(r){console.error("Error adding product variant:",r),o.fire({title:"Oops!",text:r.message,icon:"error",timer:1500})}finally{x(!1)}},E=async()=>{try{V(!0);const t=await fetch(`${N}/api/variants/product-variants`,{method:"GET",headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"}});if(!t.ok){const h=await t.json();throw new Error(h.message||"Failed to get product variants")}const r=await t.json();le(r)}catch(t){console.error("Error getting product variants data:",t)}finally{V(!1)}},W=async t=>{try{x(!0);const r=await fetch(`${N}/api/variants/product-variants/${c==null?void 0:c._id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({variantName:t.variantName,value:t.value})});if(!r.ok){const v=await r.json();throw new Error(v.message||"Failed to update product variant")}await r.json()&&(P(),await E(),o.fire({title:"Updated!",text:"Product variant updated successfully!",icon:"success",confirmButtonText:"OK",timer:1500}),Y(),j(null))}catch(r){console.error("Error updating product variant:",r),o.fire({title:"Oops!",text:r.message,icon:"error",timer:1500})}finally{x(!1)}},q=async t=>{try{const r=typeof t=="string"?[t]:t,h=await fetch(`${N}/api/variants/product-variants/bulk-delete`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({ids:r})});if(!h.ok){const ke=await h.json();throw new Error(ke.message||"Failed to delete product variant(s)")}const v=await h.json();v&&(o.fire({title:"Deleted!",text:v.message,icon:"success",confirmButtonText:"OK"}),await E())}catch(r){console.error("Error deleting product variant(s):",r),o.fire({title:"Oops!",text:r.message,icon:"error"})}};return ie?e.jsx(ye,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"Product Variants",subName:"Products"}),e.jsxs($,{children:[e.jsxs($.Header,{children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-lg-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"header-title",children:"Product Variants Management"}),e.jsx("p",{className:"text-muted mb-0",children:"Add and manage your product variants here."}),e.jsx("p",{style:{fontSize:"0.8rem"},className:"text-danger mb-0",children:"Note: You will need to first create a variant name before you can create product variants."})]}),e.jsxs("div",{className:"mt-3 mt-lg-0",children:[e.jsxs(m,{style:{border:"none"},variant:"success",disabled:!O,onClick:P,children:[e.jsx("i",{className:"bi bi-plus"})," Add New Product Variant"]}),se&&e.jsx(m,{variant:"danger",className:"ms-2",onClick:D,children:"Delete Selected"})]})]}),e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mt-3",children:[e.jsx("div",{className:"app-search d-none d-lg-block",children:e.jsx("form",{children:e.jsxs("div",{className:"input-group",style:{backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:"10px",border:"1px solid rgba(0, 0, 0, 0.1)"},children:[e.jsx("input",{type:"search",className:"form-control",placeholder:"Search Variation here...",value:F,onChange:pe,style:{backgroundColor:"transparent",border:"none",paddingLeft:"10px",color:"#333"}}),e.jsx("span",{className:"ri-search-line search-icon text-muted",style:{marginRight:"10px",color:"#666"}})]})})}),e.jsxs(g.Select,{value:u,style:{zIndex:1},onChange:t=>te(Number(t.target.value)),className:"w-auto mt-3 mt-lg-0",children:[e.jsx("option",{value:15,children:"15 items"}),e.jsx("option",{value:30,children:"30 items"}),e.jsx("option",{value:40,children:"40 items"})]})]})]}),e.jsx($.Body,{children:e.jsxs("div",{className:"table-responsive-sm",children:[e.jsxs(Ne,{className:"table-striped table-centered mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("input",{type:"checkbox",onChange:me,checked:oe})}),e.jsx("th",{children:e.jsxs("span",{onClick:xe,style:{cursor:"pointer"},children:["Variant Name ",C?"↑":"↓"]})}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:K.length>0?K.map((t,r)=>{const h=l.includes(t._id);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:h,onChange:()=>ue(t._id)})}),e.jsx("td",{children:t.variantName.name}),e.jsx("td",{children:t.value}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex",children:[e.jsx(m,{variant:"secondary",disabled:!M,onClick:()=>he(t),children:e.jsx(Se,{})}),e.jsx(m,{variant:"danger",className:"ms-2",onClick:()=>ge(t._id.toString()),disabled:!Z,children:e.jsx(Ce,{})})]})})]},r)}):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center",children:"No product variants found"})})})]}),e.jsx("nav",{className:"d-flex justify-content-end mt-3",children:e.jsxs(y,{className:"pagination-rounded mb-0",children:[e.jsx(y.Prev,{onClick:()=>i>1&&A(i-1)}),Array.from({length:B},(t,r)=>e.jsx(y.Item,{active:r+1===i,onClick:()=>A(r+1),children:r+1},r+1)),e.jsx(y.Next,{onClick:()=>i<B&&A(i+1)})]})})]})})]}),e.jsxs(f,{show:J,onHide:P,dialogClassName:"modal-dialog-centered",children:[e.jsx(f.Header,{closeButton:!0,children:e.jsxs(f.Title,{children:[c?"Edit":"Add New"," Product Variant"]})}),e.jsx(f.Body,{children:e.jsxs(g,{onSubmit:ce(c?W:Q),children:[e.jsxs(g.Group,{className:"mb-3",children:[e.jsx(g.Label,{children:"Variant Name"}),e.jsxs(g.Select,{...G("variantName",{required:"Variant name is required"}),isInvalid:!!T.variantName,children:[e.jsx("option",{value:"",children:"Select Variant Name"}),p.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsx(g.Group,{className:"mb-3",children:e.jsx(we,{label:"Value",type:"text",name:"value",containerClass:"mb-3",register:G,placeholder:"Enter variant value here...",errors:T,control:de,required:!0})}),e.jsxs(f.Footer,{children:[e.jsx(m,{variant:"light",onClick:P,children:"Close"}),e.jsx(m,{variant:"soft-success",type:"submit",disabled:c?!M:!O,children:ne?c?"Updating...":"Adding...":c?"Update Variant":"Save Variant"})]})]})})]}),e.jsx(Be,{})]})};export{at as default};
